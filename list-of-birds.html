<div id="list-container">
<p>Loading&hellip;</p>
</div>
<script src="https://cdn.jsdelivr.net/gh/beije/tumblr-tags@master/src/tumblrTags.js" type="text/javascript"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js" type="text/javascript"></script>
<script type="text/javascript">// <![CDATA[
document.addEventListener("DOMContentLoaded", function() {
    fetch('https://raw.githubusercontent.com/seppukawaii/fullfrontalbirds/main/Clements-Checklist-v2019-August-2019.csv')
      .then(response => response.arrayBuffer())
      .then(buffer => {
        let decoder = new TextDecoder("iso-8859-1");
        return decoder.decode(buffer);
      })
      .then(function (data) {
        var tagFetcher = new window.TumblrTags('fullfrontalbirds');

        tagFetcher.on(
          'ready',
          function(tags) {
            var container = document.getElementById('list-container');
            var exposedBirds = {};
            var output = '';

            for (var i in tags) {
              exposedBirds[tags[i].tag.toLowerCase()] = tags[i].hits;
            }
            
            Papa.parse(data,
              {
                  header : true,
                  encoding : "utf-8",
                  complete : function (parsedData) {
                      var allBirds = parsedData.data;
                      var currentOrder = null;
                      var currentFamily = null;
                      
                      for (var i = 0, len = allBirds.length; i < len - 1; i++) {
                          var bird = allBirds[i];
                          
                          if (currentOrder != bird.order) {
                            currentOrder = bird.order;
                            output += '</' + 'blockquote>';
                            output += '<h3><strong>';
                            
                            if (exposedBirds[bird.order.toLowerCase()]) {
                                output += `<a href="https://fullfrontalbirds.tumblr.com/tagged/${bird.order.toLowerCase()}">${bird.order}</` + `a>`;
                            }
                            else {
                                output += bird.order;
                            }
                            
                            output += '</' + 'strong></' + 'h3>';
                            output += '<blockquote>';
                          }
                          
                          if (currentFamily != bird.family) {
                              currentFamily = bird.family;
                              output += '<h4><strong>';
                              
                            if (exposedBirds[bird.family.split(' ').shift().toLowerCase()]) {
                                output += `<a href="https://fullfrontalbirds.tumblr.com/tagged/${bird.family.split(' ').shift().toLowerCase()}">${bird.family}</` + 'a>';
                            }
                            else {
                                output += bird.family;
                            }
                              
                              output += '</' + 'strong></' + 'h4>';
                          }
                          
                          
                          if (exposedBirds[bird['scientific name'].toLowerCase()]) {
                            output += `<a href="https://fullfrontalbirds.tumblr.com/tagged/${bird['scientific name'].toLowerCase()}">${bird['English name']} <em>(${bird['scientific name']})</` + 'em></' + 'a>';
                          }
                          else {
                            output += `${bird['English name']} <em>(${bird['scientific name']})</` + 'em>';
                          }
                          
                          output += '<br/>';
                      }
                      
                      container.innerHTML = output;
                  }
              });
          }
        );
        
        tagFetcher.load();
      });
  });
// ]]></script>
